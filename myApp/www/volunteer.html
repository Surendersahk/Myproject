<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Dashboard - Rescue AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body class="bg-gray-100 min-h-screen p-6">
    <h2 class="text-2xl font-bold mb-4">Victim Requests Map</h2>
    <div id="map" class="w-full h-[600px] rounded-xl shadow-lg"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6ehp-gPeTAkET4b5SmjOX24l50KIDGwE",
            authDomain: "helpnet-f5848.firebaseapp.com",
            projectId: "helpnet-f5848",
            storageBucket: "helpnet-f5848.firebasestorage.app",
            messagingSenderId: "340231424827",
            appId: "1:340231424827:web:83c9e84ee23e950cbe851e"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "login.html"; // redirect if not logged in
            }
        });

        // Initialize map
        const map = L.map('map').setView([20, 77], 4); // Center of India
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18
        }).addTo(map);

        // Load victim requests in real-time
        const colRef = collection(db, "victim_requests");
        onSnapshot(colRef, (snapshot) => {
            map.eachLayer(layer => { if (layer instanceof L.Marker) layer.remove(); }); // Clear previous markers
            snapshot.docs.forEach(doc => {
                const data = doc.data();
                const [lat, lng] = data.location.split(",").map(Number);
                L.marker([lat, lng]).addTo(map)
                    .bindPopup(`<b>${data.title}</b><br>${data.description}`);
            });
        });
    </script>
</body>

</html>